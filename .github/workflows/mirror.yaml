name: Mirror to Codeberg and GitLab

on:
  push:
    branches:
      - main  # your default branch

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all branches and tags

      - name: Push main branch to Codeberg
        env:
          CODEBERG_REPO: https://ThomasNowProductions:${{ secrets.CODEBERG_TOKEN }}@codeberg.org/BijbelQuiz/BijbelQuiz.git
        run: |
          git remote add codeberg $CODEBERG_REPO || true
          git push codeberg main --force

      - name: Push main branch to GitLab
        env:
          GITLAB_REPO: https://oauth2:${{ secrets.GITLAB_TOKEN }}@gitlab.com/ThomasNow/bijbelquiz.git
        run: |
          git remote add gitlab $GITLAB_REPO || true
          git fetch gitlab main || true
          git push gitlab main --force || echo "GitLab push failed, but continuing workflow"
